<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>0.1 License | index.split</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="0.1 License | index.split" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="0.1 License | index.split" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  


<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="0.1" data-path=""><a href="#license"><i class="fa fa-check"></i><b>0.1</b> License</a></li>
<li class="chapter" data-level="0.2" data-path=""><a href="#setup"><i class="fa fa-check"></i><b>0.2</b> Setup</a></li>
<li class="chapter" data-level="0.3" data-path=""><a href="#load-data"><i class="fa fa-check"></i><b>0.3</b> Load data</a></li>
<li class="chapter" data-level="0.4" data-path=""><a href="#wrangling"><i class="fa fa-check"></i><b>0.4</b> Wrangling</a>
<ul>
<li class="chapter" data-level="0.4.1" data-path=""><a href="#create-a-function"><i class="fa fa-check"></i><b>0.4.1</b> Create a function</a></li>
<li class="chapter" data-level="0.4.2" data-path=""><a href="#apply-the-function-to-the-data"><i class="fa fa-check"></i><b>0.4.2</b> Apply the function to the data</a></li>
</ul></li>
<li class="chapter" data-level="0.5" data-path=""><a href="#descriptive-analysis"><i class="fa fa-check"></i><b>0.5</b> Descriptive analysis</a></li>
<li class="chapter" data-level="0.6" data-path=""><a href="#modeling"><i class="fa fa-check"></i><b>0.6</b> Modeling</a>
<ul>
<li class="chapter" data-level="0.6.1" data-path=""><a href="#model-building"><i class="fa fa-check"></i><b>0.6.1</b> Model building</a></li>
<li class="chapter" data-level="0.6.2" data-path=""><a href="#model-comparisons"><i class="fa fa-check"></i><b>0.6.2</b> Model comparisons</a></li>
<li class="chapter" data-level="0.6.3" data-path=""><a href="#logistic-regression-model"><i class="fa fa-check"></i><b>0.6.3</b> Logistic regression model</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:title:end-->
<!--bookdown:title:start-->
<p>$)C‚Äî
knitr: ‚Äúbookdown::render_book‚Äù
title: ‚ÄúFairness and Bias in Machine Learning Workshop‚Äù
author: [‚ÄúJae Yeon Kim‚Äù, ‚ÄúAniket Kesari‚Äù, ‚ÄúRenata Barreto‚Äù, ‚ÄúAvery Richard‚Äù]
date: ‚Äú2020-10-07‚Äù
site: bookdown::bookdown_site
github-repo: dlab-berkeley/fairMLworkshop
output: bookdown::gitbook
documentclass: boo
description: ‚ÄúFairness and Bias in Machine Learning Workshop‚Äù
‚Äî</p>
<p><strong>Redoing ProPublica Analysis of the COMPAS dataset</strong></p>
<p>I have edited the ProPublica‚Äôs Analysis of the COMPAS dataset to increase code readability and make changing data analysis and visualization easier.</p>
<ol style="list-style-type: decimal">
<li>Bias in the data</li>
</ol>
<ul>
<li>Logistic regression analysis
<ul>
<li>Risk of Recidivism Data [<a href="https://github.com/jaeyk/compas-analysis/blob/master/code/01_risk_of_recidivism.ipynb">Code</a>]</li>
<li>Risk of Violent Recidivism Data [<a href="https://github.com/jaeyk/compas-analysis/blob/master/code/02_risk_of_violent_recidivism.ipynb">Code</a>]</li>
</ul></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li>Bias in the algorithm</li>
</ol>
<ul>
<li>Survival analysis [<a href="https://github.com/jaeyk/compas-analysis/blob/master/code/03_algorithm_accuracy.ipynb">Code</a>]</li>
</ul>
<p>For more detailed information on the Machine Bias project, I encourage to check out <a href="https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing">this article</a>.</p>
<p><a href="https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing/">Argument</a> by Julia Angwin, Jeff Larson, Surya Mattu and Lauren Kirchner</p>
<p><a href="https://www.washingtonpost.com/news/monkey-cage/wp/2016/10/17/can-an-algorithm-be-racist-our-analysis-is-more-cautious-than-propublicas/">Counterargument</a> by Sam Corbett-Davies, Emma Pierson, Avi Feller and Sharad Goel</p>
<p><a href="https://www.propublica.org/article/how-we-analyzed-the-compas-recidivism-algorithm/">Methodology</a></p>
<p><a href="https://github.com/propublica/compas-analysis/blob/master/Compas%20Analysis.ipynb">Original Notebook in R</a></p>
<div id="license" class="section level2" number="0.1">
<h2><span class="header-section-number">0.1</span> License</h2>
<p><img src="https://i.creativecommons.org/l/by/4.0/88x31.png" /> This work is licensed under a <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.</p>

<p>$)C# Risk of recidivism analysis</p>
</div>
<div id="setup" class="section level2" number="0.2">
<h2><span class="header-section-number">0.2</span> Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;pacman&quot;</span>)) <span class="kw">install.packages</span>(<span class="st">&quot;pacman&quot;</span>, <span class="dt">repos =</span> <span class="st">&quot;http://cran.us.r-project.org&quot;</span>)</span>
<span id="cb1-2"><a href="#cb1-2"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(</span>
<span id="cb1-3"><a href="#cb1-3"></a> tidyverse, <span class="co"># tidyverse packages </span></span>
<span id="cb1-4"><a href="#cb1-4"></a> conflicted, <span class="co"># an alternative conflict resolution strategy </span></span>
<span id="cb1-5"><a href="#cb1-5"></a> patchwork, <span class="co"># arranging ggplots</span></span>
<span id="cb1-6"><a href="#cb1-6"></a> scales, <span class="co"># rescaling </span></span>
<span id="cb1-7"><a href="#cb1-7"></a> survival, <span class="co"># survival analysis</span></span>
<span id="cb1-8"><a href="#cb1-8"></a> broom, <span class="co"># for modeling</span></span>
<span id="cb1-9"><a href="#cb1-9"></a> here, <span class="co"># reproducibility </span></span>
<span id="cb1-10"><a href="#cb1-10"></a> glue <span class="co"># pasting strings and objects </span></span>
<span id="cb1-11"><a href="#cb1-11"></a>)</span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co"># To avoid conflicts </span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>) </span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;select&quot;</span>, <span class="st">&quot;dplyr&quot;</span>) </span></code></pre></div>
</div>
<div id="load-data" class="section level2" number="0.3">
<h2><span class="header-section-number">0.3</span> Load data</h2>
<p>We select fields for severity of charge, number of priors, demographics, age, sex, COMPAS scores, and whether each person was accused of a crime within two years.</p>
<ul>
<li>N of observations (rows): 7,214</li>
<li>N of variables (columns): 53</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>two_years &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;compas-scores-two-years.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Duplicated column names deduplicated: &#39;decile_score&#39; =&gt;
## &#39;decile_score_1&#39; [40], &#39;priors_count&#39; =&gt; &#39;priors_count_1&#39; [49]</code></pre>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">dim</span>(two_years)</span></code></pre></div>
<pre><code>## [1] 7214   53</code></pre>
</div>
<div id="wrangling" class="section level2" number="0.4">
<h2><span class="header-section-number">0.4</span> Wrangling</h2>
<ul>
<li>Not all of the observations are useable for the first round of analysis.</li>
<li>There are a number of reasons to remove rows because of missing data:
<ul>
<li>If the charge date of a defendants COMPAS scored crime was not within 30 days from when the person was arrested, we assume that because of data quality reasons, that we do not have the right offense.</li>
<li>We coded the recidivist flag ‚Äì is_recid ‚Äì to be -1 if we could not find a COMPAS case at all.</li>
<li>In a similar vein, ordinary traffic offenses ‚Äì those with a c_charge_degree of ‚ÄòO‚Äô ‚Äì will not result in Jail time are removed (only two of them).</li>
<li>We filtered the underlying data from Broward county to include only those rows representing people who had either recidivated in two years, or had at least two years outside of a correctional facility.</li>
</ul></li>
</ul>
<div id="create-a-function" class="section level3" number="0.4.1">
<h3><span class="header-section-number">0.4.1</span> Create a function</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>wrangle_data &lt;-<span class="st"> </span><span class="cf">function</span>(data){</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>df &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="st">    </span></span>
<span id="cb6-5"><a href="#cb6-5"></a><span class="st">    </span><span class="co"># Select variables </span></span>
<span id="cb6-6"><a href="#cb6-6"></a><span class="st">    </span><span class="kw">select</span>(age, c_charge_degree, race, age_cat, score_text, sex, priors_count, days_b_screening_arrest, decile_score, is_recid, two_year_recid, </span>
<span id="cb6-7"><a href="#cb6-7"></a>         c_jail_in, c_jail_out) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-8"><a href="#cb6-8"></a><span class="st">    </span><span class="co"># Filter rows </span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="st">    </span><span class="kw">filter</span>(days_b_screening_arrest <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>,</span>
<span id="cb6-10"><a href="#cb6-10"></a>           days_b_screening_arrest <span class="op">&gt;=</span><span class="st"> </span><span class="dv">-30</span>, </span>
<span id="cb6-11"><a href="#cb6-11"></a>           is_recid <span class="op">!=</span><span class="st"> </span><span class="dv">-1</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>           c_charge_degree <span class="op">!=</span><span class="st"> &quot;O&quot;</span>,</span>
<span id="cb6-13"><a href="#cb6-13"></a>           score_text <span class="op">!=</span><span class="st"> &#39;N/A&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="st">    </span><span class="co"># Mutate variables </span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">length_of_stay =</span> <span class="kw">as.numeric</span>(<span class="kw">as.Date</span>(c_jail_out) <span class="op">-</span><span class="st"> </span><span class="kw">as.Date</span>(c_jail_in)),</span>
<span id="cb6-16"><a href="#cb6-16"></a>           <span class="dt">c_charge_degree =</span> <span class="kw">factor</span>(c_charge_degree),</span>
<span id="cb6-17"><a href="#cb6-17"></a>           <span class="dt">age_cat =</span> <span class="kw">factor</span>(age_cat),</span>
<span id="cb6-18"><a href="#cb6-18"></a>           <span class="dt">race =</span> <span class="kw">factor</span>(race, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Caucasian&quot;</span>,<span class="st">&quot;African-American&quot;</span>,<span class="st">&quot;Hispanic&quot;</span>,<span class="st">&quot;Other&quot;</span>,<span class="st">&quot;Asian&quot;</span>,<span class="st">&quot;Native American&quot;</span>)),</span>
<span id="cb6-19"><a href="#cb6-19"></a>           <span class="dt">sex =</span> <span class="kw">factor</span>(sex, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>)),</span>
<span id="cb6-20"><a href="#cb6-20"></a>           <span class="dt">score_text =</span> <span class="kw">factor</span>(score_text, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;High&quot;</span>)),</span>
<span id="cb6-21"><a href="#cb6-21"></a>           <span class="dt">score =</span> score_text,</span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co"># I added this new variable to test whether measuring the DV as a binary or continuous var makes a difference </span></span>
<span id="cb6-23"><a href="#cb6-23"></a>           <span class="dt">score_num =</span> <span class="kw">as.numeric</span>(score_text)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="st">    </span><span class="co"># Rename variables </span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="st">    </span><span class="kw">rename</span>(<span class="dt">crime =</span> c_charge_degree,</span>
<span id="cb6-26"><a href="#cb6-26"></a>           <span class="dt">gender =</span> sex)</span>
<span id="cb6-27"><a href="#cb6-27"></a>        </span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="kw">return</span>(df)}</span></code></pre></div>
</div>
<div id="apply-the-function-to-the-data" class="section level3" number="0.4.2">
<h3><span class="header-section-number">0.4.2</span> Apply the function to the data</h3>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>df &lt;-<span class="st"> </span><span class="kw">wrangle_data</span>(two_years)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="kw">names</span>(df)</span></code></pre></div>
<pre><code>##  [1] &quot;age&quot;                     &quot;crime&quot;                  
##  [3] &quot;race&quot;                    &quot;age_cat&quot;                
##  [5] &quot;score_text&quot;              &quot;gender&quot;                 
##  [7] &quot;priors_count&quot;            &quot;days_b_screening_arrest&quot;
##  [9] &quot;decile_score&quot;            &quot;is_recid&quot;               
## [11] &quot;two_year_recid&quot;          &quot;c_jail_in&quot;              
## [13] &quot;c_jail_out&quot;              &quot;length_of_stay&quot;         
## [15] &quot;score&quot;                   &quot;score_num&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Check whether the function works as expected</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="kw">head</span>(df, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 16
##     age crime race  age_cat score_text gender priors_count days_b_screenin‚Ä¶
##   &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;   &lt;fct&gt;      &lt;fct&gt;         &lt;dbl&gt;            &lt;dbl&gt;
## 1    69 F     Other Greate‚Ä¶ Low        Male              0               -1
## 2    34 F     Afri‚Ä¶ 25 - 45 Low        Male              0               -1
## 3    24 F     Afri‚Ä¶ Less t‚Ä¶ Low        Male              4               -1
## 4    44 M     Other 25 - 45 Low        Male              0                0
## 5    41 F     Cauc‚Ä¶ 25 - 45 Medium     Male             14               -1
## # ‚Ä¶ with 8 more variables: decile_score &lt;dbl&gt;, is_recid &lt;dbl&gt;,
## #   two_year_recid &lt;dbl&gt;, c_jail_in &lt;dttm&gt;, c_jail_out &lt;dttm&gt;,
## #   length_of_stay &lt;dbl&gt;, score &lt;fct&gt;, score_num &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="descriptive-analysis" class="section level2" number="0.5">
<h2><span class="header-section-number">0.5</span> Descriptive analysis</h2>
<ul>
<li>Higher COMPAS scores are slightly correlated with a longer length of stay.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="kw">cor</span>(df<span class="op">$</span>length_of_stay, df<span class="op">$</span>decile_score)</span></code></pre></div>
<pre><code>## [1] 0.2073297</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># Set theme</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>ggplot2<span class="op">::</span><span class="kw">theme_set</span>(<span class="kw">theme_minimal</span>())</span>
<span id="cb13-3"><a href="#cb13-3"></a></span>
<span id="cb13-4"><a href="#cb13-4"></a>df <span class="op">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">  </span><span class="kw">group_by</span>(score) <span class="op">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="st">  </span><span class="kw">count</span>() <span class="op">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> score, <span class="dt">y =</span> n)) <span class="op">+</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="st">    </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb13-9"><a href="#cb13-9"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Score&quot;</span>,</span>
<span id="cb13-10"><a href="#cb13-10"></a>         <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb13-11"><a href="#cb13-11"></a>         <span class="dt">title =</span> <span class="st">&quot;Score distribution&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" width="672" />
Judges are often presented with two sets of scores from the COMPAS system ‚Äì one that classifies people into High, Medium and Low risk, and a corresponding decile score. There is a clear downward trend in the decile scores as those scores increase for white defendants.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>df <span class="op">%&gt;%</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">ordered</span>(decile_score))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="st">          </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="st">          </span><span class="kw">facet_wrap</span>(<span class="op">~</span>race, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="st">          </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Decile Score&quot;</span>,</span>
<span id="cb14-6"><a href="#cb14-6"></a>               <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb14-7"><a href="#cb14-7"></a>               <span class="dt">Title =</span> <span class="st">&quot;Defendant&#39;s Decile Score&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
</div>
<div id="modeling" class="section level2" number="0.6">
<h2><span class="header-section-number">0.6</span> Modeling</h2>
<p>After filtering out bad rows, our first question is whether there is a significant difference in COMPAS scores between races. To do so we need to change some variables into factors, and run a logistic regression, comparing low scores to high scores.</p>
<div id="model-building" class="section level3" number="0.6.1">
<h3><span class="header-section-number">0.6.1</span> Model building</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>model_data &lt;-<span class="st"> </span><span class="cf">function</span>(data){</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="co"># Logistic regression model</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>lr_model &lt;-<span class="st"> </span><span class="kw">glm</span>(score <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age_cat <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>priors_count <span class="op">+</span><span class="st"> </span>crime <span class="op">+</span><span class="st"> </span>two_year_recid, </span>
<span id="cb15-5"><a href="#cb15-5"></a>             <span class="dt">family =</span> <span class="st">&quot;binomial&quot;</span>, <span class="dt">data =</span> data)</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a><span class="co"># OLS, DV = score_num</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>ols_model1 &lt;-<span class="st"> </span><span class="kw">lm</span>(score_num <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age_cat <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>priors_count <span class="op">+</span><span class="st"> </span>crime <span class="op">+</span><span class="st"> </span>two_year_recid, <span class="dt">data =</span> data)</span>
<span id="cb15-9"><a href="#cb15-9"></a></span>
<span id="cb15-10"><a href="#cb15-10"></a><span class="co"># OLS, DV = decile_score </span></span>
<span id="cb15-11"><a href="#cb15-11"></a>ols_model2 &lt;-<span class="st"> </span><span class="kw">lm</span>(decile_score <span class="op">~</span><span class="st"> </span>gender <span class="op">+</span><span class="st"> </span>age_cat <span class="op">+</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>priors_count <span class="op">+</span><span class="st"> </span>crime <span class="op">+</span><span class="st"> </span>two_year_recid, <span class="dt">data =</span> data)</span>
<span id="cb15-12"><a href="#cb15-12"></a></span>
<span id="cb15-13"><a href="#cb15-13"></a><span class="co"># Extract model outcomes with confidence intervals </span></span>
<span id="cb15-14"><a href="#cb15-14"></a>lr_est &lt;-<span class="st"> </span>lr_model <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-15"><a href="#cb15-15"></a><span class="st">    </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) </span>
<span id="cb15-16"><a href="#cb15-16"></a></span>
<span id="cb15-17"><a href="#cb15-17"></a>ols_est1 &lt;-<span class="st"> </span>ols_model1 <span class="op">%&gt;%</span></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="st">    </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) </span>
<span id="cb15-19"><a href="#cb15-19"></a></span>
<span id="cb15-20"><a href="#cb15-20"></a>ols_est2 &lt;-<span class="st"> </span>ols_model2 <span class="op">%&gt;%</span></span>
<span id="cb15-21"><a href="#cb15-21"></a><span class="st">    </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) </span>
<span id="cb15-22"><a href="#cb15-22"></a></span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co"># AIC scores </span></span>
<span id="cb15-24"><a href="#cb15-24"></a>lr_AIC &lt;-<span class="st"> </span><span class="kw">AIC</span>(lr_model)</span>
<span id="cb15-25"><a href="#cb15-25"></a>ols_AIC1 &lt;-<span class="st"> </span><span class="kw">AIC</span>(ols_model1)</span>
<span id="cb15-26"><a href="#cb15-26"></a>ols_AIC2 &lt;-<span class="st"> </span><span class="kw">AIC</span>(ols_model2)</span>
<span id="cb15-27"><a href="#cb15-27"></a>    </span>
<span id="cb15-28"><a href="#cb15-28"></a><span class="kw">list</span>(lr_est, ols_est1, ols_est2, </span>
<span id="cb15-29"><a href="#cb15-29"></a>     lr_AIC, ols_AIC1, ols_AIC2)</span>
<span id="cb15-30"><a href="#cb15-30"></a></span>
<span id="cb15-31"><a href="#cb15-31"></a>}</span></code></pre></div>
</div>
<div id="model-comparisons" class="section level3" number="0.6.2">
<h3><span class="header-section-number">0.6.2</span> Model comparisons</h3>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="kw">glue</span>(<span class="st">&quot;AIC score of logistic regression: {model_data(df)[4]} </span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="st">      AIC score of OLS regression (with categorical DV):  {model_data(df)[5]}</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="st">      AIC score of OLS regression (with continuous DV): {model_data(df)[6]}&quot;</span>)</span></code></pre></div>
<pre><code>## AIC score of logistic regression: 6192.40169473357 
## AIC score of OLS regression (with categorical DV):  11772.1148541111
## AIC score of OLS regression (with continuous DV): 26779.9512226999</code></pre>
</div>
<div id="logistic-regression-model" class="section level3" number="0.6.3">
<h3><span class="header-section-number">0.6.3</span> Logistic regression model</h3>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>lr_model &lt;-<span class="st"> </span><span class="kw">model_data</span>(df)[<span class="dv">1</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">data.frame</span>()</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>lr_model <span class="op">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;(Intercept)&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">gsub</span>(<span class="st">&quot;race|age_cat|gender|M&quot;</span>,<span class="st">&quot;&quot;</span>, term)) <span class="op">%&gt;%</span></span>
<span id="cb18-6"><a href="#cb18-6"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(term, estimate), <span class="dt">y =</span> estimate, <span class="dt">ymax =</span> conf.high, <span class="dt">ymin =</span> conf.low)) <span class="op">+</span></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb18-9"><a href="#cb18-9"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>      <span class="dt">title =</span> <span class="st">&quot;Logistic regression&quot;</span>) <span class="op">+</span></span>
<span id="cb18-11"><a href="#cb18-11"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>interpret_estimate &lt;-<span class="st"> </span><span class="cf">function</span>(model){</span>
<span id="cb19-2"><a href="#cb19-2"></a>    </span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="co"># Control </span></span>
<span id="cb19-4"><a href="#cb19-4"></a>    intercept &lt;-<span class="st"> </span>model<span class="op">$</span>estimate[model<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;(Intercept)&quot;</span>]</span>
<span id="cb19-5"><a href="#cb19-5"></a>    control &lt;-<span class="st"> </span><span class="kw">exp</span>(intercept) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw">exp</span>(intercept))</span>
<span id="cb19-6"><a href="#cb19-6"></a>    </span>
<span id="cb19-7"><a href="#cb19-7"></a>    <span class="co"># Likelihood </span></span>
<span id="cb19-8"><a href="#cb19-8"></a>    model &lt;-<span class="st"> </span>model <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;(Intercept)&quot;</span>)</span>
<span id="cb19-9"><a href="#cb19-9"></a>    </span>
<span id="cb19-10"><a href="#cb19-10"></a>    model<span class="op">$</span>likelihood &lt;-<span class="st"> </span>(<span class="kw">exp</span>(model<span class="op">$</span>estimate) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>control <span class="op">+</span><span class="st"> </span>(control <span class="op">*</span><span class="st"> </span><span class="kw">exp</span>(model<span class="op">$</span>estimate))))</span>
<span id="cb19-11"><a href="#cb19-11"></a>    </span>
<span id="cb19-12"><a href="#cb19-12"></a>    <span class="kw">return</span>(model)</span>
<span id="cb19-13"><a href="#cb19-13"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="kw">interpret_estimate</span>(lr_model) <span class="op">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">gsub</span>(<span class="st">&quot;race|age_cat|gender&quot;</span>,<span class="st">&quot;&quot;</span>, term)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(term, likelihood), <span class="dt">y =</span> likelihood)) <span class="op">+</span></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="st">        </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></span>
<span id="cb20-5"><a href="#cb20-5"></a><span class="st">        </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb20-6"><a href="#cb20-6"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Likelihood&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>            <span class="dt">title =</span><span class="st">&quot;Logistic regression&quot;</span>) <span class="op">+</span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="st">        </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">percent_format</span>(<span class="dt">accuracy =</span> <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb20-9"><a href="#cb20-9"></a><span class="st">        </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>


    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
