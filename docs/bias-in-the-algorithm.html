<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Bias in the algorithm | Fairness and Bias in Machine Learning Workshop</title>
  <meta name="description" content="Chapter 4 Bias in the algorithm | Fairness and Bias in Machine Learning Workshop" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Bias in the algorithm | Fairness and Bias in Machine Learning Workshop" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Chapter 4 Bias in the algorithm | Fairness and Bias in Machine Learning Workshop" />
  <meta name="github-repo" content="dlab-berkeley/fairMLworkshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Bias in the algorithm | Fairness and Bias in Machine Learning Workshop" />
  
  <meta name="twitter:description" content="Chapter 4 Bias in the algorithm | Fairness and Bias in Machine Learning Workshop" />
  

<meta name="author" content="Jae Yeon Kim" />
<meta name="author" content="Aniket Kesari" />
<meta name="author" content="Renata Barreto" />
<meta name="author" content="Avery Richard" />


<meta name="date" content="2020-10-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="bias-in-the-data-risk-of-violent-recidivism-analysis.html"/>

<script src="libs/header-attrs-2.4/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Redoing ProPublica Analysis of the COMPAS dataset</a></li>
<li class="chapter" data-level="2" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html"><i class="fa fa-check"></i><b>2</b> Bias in the Data (Risk of Recidivism Analysis)</a>
<ul>
<li class="chapter" data-level="2.1" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#setup"><i class="fa fa-check"></i><b>2.1</b> Setup</a></li>
<li class="chapter" data-level="2.2" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#load-data"><i class="fa fa-check"></i><b>2.2</b> Load data</a></li>
<li class="chapter" data-level="2.3" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#wrangling"><i class="fa fa-check"></i><b>2.3</b> Wrangling</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#create-a-function"><i class="fa fa-check"></i><b>2.3.1</b> Create a function</a></li>
<li class="chapter" data-level="2.3.2" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#apply-the-function-to-the-data"><i class="fa fa-check"></i><b>2.3.2</b> Apply the function to the data</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#descriptive-analysis"><i class="fa fa-check"></i><b>2.4</b> Descriptive analysis</a></li>
<li class="chapter" data-level="2.5" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#modeling"><i class="fa fa-check"></i><b>2.5</b> Modeling</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#model-building"><i class="fa fa-check"></i><b>2.5.1</b> Model building</a></li>
<li class="chapter" data-level="2.5.2" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#model-comparisons"><i class="fa fa-check"></i><b>2.5.2</b> Model comparisons</a></li>
<li class="chapter" data-level="2.5.3" data-path="bias-in-the-data-risk-of-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-recidivism-analysis.html#logistic-regression-model"><i class="fa fa-check"></i><b>2.5.3</b> Logistic regression model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><i class="fa fa-check"></i><b>3</b> Bias in the Data (Risk of Violent Recidivism Analysis)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#setup-1"><i class="fa fa-check"></i><b>3.1</b> Setup</a></li>
<li class="chapter" data-level="3.2" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#load-data-1"><i class="fa fa-check"></i><b>3.2</b> Load data</a></li>
<li class="chapter" data-level="3.3" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#wrangling-1"><i class="fa fa-check"></i><b>3.3</b> Wrangling</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#create-a-function-1"><i class="fa fa-check"></i><b>3.3.1</b> Create a function</a></li>
<li class="chapter" data-level="3.3.2" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#apply-the-function-to-the-data-1"><i class="fa fa-check"></i><b>3.3.2</b> Apply the function to the data</a></li>
<li class="chapter" data-level="3.3.3" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#descriptive-analysis-1"><i class="fa fa-check"></i><b>3.3.3</b> Descriptive analysis</a></li>
<li class="chapter" data-level="3.3.4" data-path="bias-in-the-data-risk-of-violent-recidivism-analysis.html"><a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html#modeling-1"><i class="fa fa-check"></i><b>3.3.4</b> Modeling</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html"><i class="fa fa-check"></i><b>4</b> Bias in the algorithm</a>
<ul>
<li class="chapter" data-level="4.1" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#setup-2"><i class="fa fa-check"></i><b>4.1</b> Setup</a></li>
<li class="chapter" data-level="4.2" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#load-data-2"><i class="fa fa-check"></i><b>4.2</b> Load data</a></li>
<li class="chapter" data-level="4.3" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#wrangling-2"><i class="fa fa-check"></i><b>4.3</b> Wrangling</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#descriptive-analysis-2"><i class="fa fa-check"></i><b>4.3.1</b> Descriptive analysis</a></li>
<li class="chapter" data-level="4.3.2" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#modeling-2"><i class="fa fa-check"></i><b>4.3.2</b> Modeling</a></li>
<li class="chapter" data-level="4.3.3" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#risk-of-recidivism-accuracy"><i class="fa fa-check"></i><b>4.3.3</b> Risk of Recidivism Accuracy</a></li>
<li class="chapter" data-level="4.3.4" data-path="bias-in-the-algorithm.html"><a href="bias-in-the-algorithm.html#risk-of-violent-recidivism"><i class="fa fa-check"></i><b>4.3.4</b> Risk of violent recidivism</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Fairness and Bias in Machine Learning Workshop</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bias-in-the-algorithm" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Bias in the algorithm</h1>
<ul>
<li><p>In order to test whether COMPAS scores do an accurate job of deciding whether an offender is Low, Medium or High risk, we ran a Cox Proportional Hazards model. Northpointe, the company that created COMPAS and markets it to Law Enforcement, also ran a Cox model in <a href="https://journals.sagepub.com/doi/abs/10.1177/0093854808326545">their validation study</a>.</p></li>
<li><p>We used the counting model and removed people when they were incarcerated. Due to errors in the underlying jail data, we need to filter out 32 rows that have an end date more than the start date. Considering that there are 13,334 total rows in the data, such a small amount of errors will not affect the results.</p></li>
</ul>
<div id="setup-2" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Setup</h2>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="bias-in-the-algorithm.html#cb51-1"></a><span class="cf">if</span> (<span class="op">!</span><span class="kw">require</span>(<span class="st">&quot;pacman&quot;</span>)) <span class="kw">install.packages</span>(<span class="st">&quot;pacman&quot;</span>)</span></code></pre></div>
<pre><code>## Loading required package: pacman</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="bias-in-the-algorithm.html#cb53-1"></a>pacman<span class="op">::</span><span class="kw">p_load</span>(</span>
<span id="cb53-2"><a href="bias-in-the-algorithm.html#cb53-2"></a> tidyverse, <span class="co"># tidyverse packages </span></span>
<span id="cb53-3"><a href="bias-in-the-algorithm.html#cb53-3"></a> conflicted, <span class="co"># an alternative conflict resolution strategy </span></span>
<span id="cb53-4"><a href="bias-in-the-algorithm.html#cb53-4"></a> ggthemes, <span class="co"># other themes for ggplot2 </span></span>
<span id="cb53-5"><a href="bias-in-the-algorithm.html#cb53-5"></a> patchwork, <span class="co"># arranging ggplots</span></span>
<span id="cb53-6"><a href="bias-in-the-algorithm.html#cb53-6"></a> scales, <span class="co"># rescaling </span></span>
<span id="cb53-7"><a href="bias-in-the-algorithm.html#cb53-7"></a> survival, <span class="co"># survival analysis</span></span>
<span id="cb53-8"><a href="bias-in-the-algorithm.html#cb53-8"></a> broom, <span class="co"># for modeling</span></span>
<span id="cb53-9"><a href="bias-in-the-algorithm.html#cb53-9"></a> here, <span class="co"># reproducibility </span></span>
<span id="cb53-10"><a href="bias-in-the-algorithm.html#cb53-10"></a> glue, <span class="co"># pasting strings and objects </span></span>
<span id="cb53-11"><a href="bias-in-the-algorithm.html#cb53-11"></a> reticulate <span class="co"># source python codes</span></span>
<span id="cb53-12"><a href="bias-in-the-algorithm.html#cb53-12"></a>)</span>
<span id="cb53-13"><a href="bias-in-the-algorithm.html#cb53-13"></a></span>
<span id="cb53-14"><a href="bias-in-the-algorithm.html#cb53-14"></a><span class="co"># To avoid conflicts </span></span>
<span id="cb53-15"><a href="bias-in-the-algorithm.html#cb53-15"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;filter&quot;</span>, <span class="st">&quot;dplyr&quot;</span>) </span></code></pre></div>
<pre><code>## [conflicted] Will prefer dplyr::filter over any other package</code></pre>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="bias-in-the-algorithm.html#cb55-1"></a><span class="kw">conflict_prefer</span>(<span class="st">&quot;select&quot;</span>, <span class="st">&quot;dplyr&quot;</span>) </span></code></pre></div>
<pre><code>## [conflicted] Will prefer dplyr::select over any other package</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="bias-in-the-algorithm.html#cb57-1"></a><span class="co"># Set themes </span></span>
<span id="cb57-2"><a href="bias-in-the-algorithm.html#cb57-2"></a><span class="kw">theme_set</span>(ggthemes<span class="op">::</span><span class="kw">theme_fivethirtyeight</span>())</span></code></pre></div>
</div>
<div id="load-data-2" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Load data</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="bias-in-the-algorithm.html#cb58-1"></a>cox_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span> ,<span class="st">&quot;cox-parsed.csv&quot;</span>))</span></code></pre></div>
<pre><code>## Warning: Duplicated column names deduplicated: &#39;decile_score&#39; =&gt;
## &#39;decile_score_1&#39; [40], &#39;priors_count&#39; =&gt; &#39;priors_count_1&#39; [49]</code></pre>
<pre><code>## 
## ── Column specification ───────────────────────
## cols(
##   .default = col_character(),
##   id = col_double(),
##   compas_screening_date = col_date(format = &quot;&quot;),
##   dob = col_date(format = &quot;&quot;),
##   age = col_double(),
##   juv_fel_count = col_double(),
##   decile_score = col_double(),
##   juv_misd_count = col_double(),
##   juv_other_count = col_double(),
##   priors_count = col_double(),
##   days_b_screening_arrest = col_double(),
##   c_jail_in = col_datetime(format = &quot;&quot;),
##   c_jail_out = col_datetime(format = &quot;&quot;),
##   c_offense_date = col_date(format = &quot;&quot;),
##   c_arrest_date = col_date(format = &quot;&quot;),
##   c_days_from_compas = col_double(),
##   is_recid = col_double(),
##   r_days_from_arrest = col_double(),
##   r_offense_date = col_date(format = &quot;&quot;),
##   r_jail_in = col_date(format = &quot;&quot;),
##   r_jail_out = col_date(format = &quot;&quot;)
##   # ... with 13 more columns
## )
## ℹ Use `spec()` for the full column specifications.</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="bias-in-the-algorithm.html#cb61-1"></a><span class="kw">glue</span>(<span class="st">&quot;N of observations (rows): {nrow(cox_data)}</span></span>
<span id="cb61-2"><a href="bias-in-the-algorithm.html#cb61-2"></a><span class="st">      N of variables (columns): {ncol(cox_data)}&quot;</span>)</span></code></pre></div>
<pre><code>## N of observations (rows): 13419
## N of variables (columns): 52</code></pre>
</div>
<div id="wrangling-2" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Wrangling</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="bias-in-the-algorithm.html#cb63-1"></a>df &lt;-<span class="st"> </span>cox_data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb63-2"><a href="bias-in-the-algorithm.html#cb63-2"></a><span class="st">    </span><span class="kw">filter</span>(score_text <span class="op">!=</span><span class="st"> &quot;N/A&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb63-3"><a href="bias-in-the-algorithm.html#cb63-3"></a><span class="st">    </span><span class="kw">filter</span>(end <span class="op">&gt;</span><span class="st"> </span>start) <span class="op">%&gt;%</span></span>
<span id="cb63-4"><a href="bias-in-the-algorithm.html#cb63-4"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">c_charge_degree =</span> <span class="kw">factor</span>(c_charge_degree),</span>
<span id="cb63-5"><a href="bias-in-the-algorithm.html#cb63-5"></a>           <span class="dt">age_cat =</span> <span class="kw">factor</span>(age_cat),</span>
<span id="cb63-6"><a href="bias-in-the-algorithm.html#cb63-6"></a>           <span class="dt">race =</span> <span class="kw">factor</span>(race, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Caucasian&quot;</span>,<span class="st">&quot;African-American&quot;</span>,<span class="st">&quot;Hispanic&quot;</span>,<span class="st">&quot;Other&quot;</span>,<span class="st">&quot;Asian&quot;</span>,<span class="st">&quot;Native American&quot;</span>)),</span>
<span id="cb63-7"><a href="bias-in-the-algorithm.html#cb63-7"></a>           <span class="dt">sex =</span> <span class="kw">factor</span>(sex, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>)),</span>
<span id="cb63-8"><a href="bias-in-the-algorithm.html#cb63-8"></a>           <span class="dt">score_factor =</span> <span class="kw">factor</span>(score_text, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Low&quot;</span>, <span class="st">&quot;Medium&quot;</span>, <span class="st">&quot;High&quot;</span>)))</span>
<span id="cb63-9"><a href="bias-in-the-algorithm.html#cb63-9"></a></span>
<span id="cb63-10"><a href="bias-in-the-algorithm.html#cb63-10"></a>grp &lt;-<span class="st"> </span>df[<span class="op">!</span><span class="kw">duplicated</span>(df<span class="op">$</span>id),]</span></code></pre></div>
<div id="descriptive-analysis-2" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Descriptive analysis</h3>
<p>Score distribution</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="bias-in-the-algorithm.html#cb64-1"></a>grp <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb64-2"><a href="bias-in-the-algorithm.html#cb64-2"></a><span class="st">    </span><span class="kw">group_by</span>(score_factor) <span class="op">%&gt;%</span></span>
<span id="cb64-3"><a href="bias-in-the-algorithm.html#cb64-3"></a><span class="st">      </span><span class="kw">count</span>() <span class="op">%&gt;%</span></span>
<span id="cb64-4"><a href="bias-in-the-algorithm.html#cb64-4"></a><span class="st">      </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> score_factor, <span class="dt">y =</span> n)) <span class="op">+</span></span>
<span id="cb64-5"><a href="bias-in-the-algorithm.html#cb64-5"></a><span class="st">        </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb64-6"><a href="bias-in-the-algorithm.html#cb64-6"></a><span class="st">        </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Score&quot;</span>,</span>
<span id="cb64-7"><a href="bias-in-the-algorithm.html#cb64-7"></a>             <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb64-8"><a href="bias-in-the-algorithm.html#cb64-8"></a>             <span class="dt">title =</span> <span class="st">&quot;Score distribution&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Score distribution by race</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="bias-in-the-algorithm.html#cb65-1"></a>df <span class="op">%&gt;%</span></span>
<span id="cb65-2"><a href="bias-in-the-algorithm.html#cb65-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">ordered</span>(score_factor))) <span class="op">+</span><span class="st"> </span></span>
<span id="cb65-3"><a href="bias-in-the-algorithm.html#cb65-3"></a><span class="st">          </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb65-4"><a href="bias-in-the-algorithm.html#cb65-4"></a><span class="st">          </span><span class="kw">facet_wrap</span>(<span class="op">~</span>race, <span class="dt">nrow =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb65-5"><a href="bias-in-the-algorithm.html#cb65-5"></a><span class="st">          </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Decile Score&quot;</span>,</span>
<span id="cb65-6"><a href="bias-in-the-algorithm.html#cb65-6"></a>               <span class="dt">y =</span> <span class="st">&quot;Count&quot;</span>,</span>
<span id="cb65-7"><a href="bias-in-the-algorithm.html#cb65-7"></a>               <span class="dt">Title =</span> <span class="st">&quot;Defendant&#39;s Decile Score&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="modeling-2" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Modeling</h3>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="bias-in-the-algorithm.html#cb66-1"></a>f2 &lt;-<span class="st"> </span><span class="kw">Surv</span>(start, end, event, <span class="dt">type=</span><span class="st">&quot;counting&quot;</span>) <span class="op">~</span><span class="st"> </span>race <span class="op">+</span><span class="st"> </span>score_factor <span class="op">+</span><span class="st"> </span>race <span class="op">*</span><span class="st"> </span>score_factor</span>
<span id="cb66-2"><a href="bias-in-the-algorithm.html#cb66-2"></a></span>
<span id="cb66-3"><a href="bias-in-the-algorithm.html#cb66-3"></a>model &lt;-<span class="st"> </span><span class="kw">coxph</span>(f2, <span class="dt">data =</span> df)</span>
<span id="cb66-4"><a href="bias-in-the-algorithm.html#cb66-4"></a></span>
<span id="cb66-5"><a href="bias-in-the-algorithm.html#cb66-5"></a>model <span class="op">%&gt;%</span></span>
<span id="cb66-6"><a href="bias-in-the-algorithm.html#cb66-6"></a><span class="st">  </span>broom<span class="op">::</span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb66-7"><a href="bias-in-the-algorithm.html#cb66-7"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">gsub</span>(<span class="st">&quot;race|score_factor&quot;</span>,<span class="st">&quot;&quot;</span>, term)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb66-8"><a href="bias-in-the-algorithm.html#cb66-8"></a><span class="st">  </span><span class="kw">filter</span>(term <span class="op">!=</span><span class="st"> &quot;&lt;chr&gt;&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb66-9"><a href="bias-in-the-algorithm.html#cb66-9"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">fct_reorder</span>(term, estimate), <span class="dt">y =</span> estimate, <span class="dt">ymax =</span> conf.high, <span class="dt">ymin =</span> conf.low)) <span class="op">+</span></span>
<span id="cb66-10"><a href="bias-in-the-algorithm.html#cb66-10"></a><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span></span>
<span id="cb66-11"><a href="bias-in-the-algorithm.html#cb66-11"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb66-12"><a href="bias-in-the-algorithm.html#cb66-12"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;Estimate&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The interaction term shows a similar disparity as the logistic regression above.</p>
<p>High risk white defendants are 3.61 more likely than low risk white defendants, while High risk black defendants are 2.99 more likely than low.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="bias-in-the-algorithm.html#cb67-1"></a>visualize_surv &lt;-<span class="st"> </span><span class="cf">function</span>(input){</span>
<span id="cb67-2"><a href="bias-in-the-algorithm.html#cb67-2"></a>  </span>
<span id="cb67-3"><a href="bias-in-the-algorithm.html#cb67-3"></a>f &lt;-<span class="st"> </span><span class="kw">Surv</span>(start, end, event, <span class="dt">type=</span><span class="st">&quot;counting&quot;</span>) <span class="op">~</span><span class="st"> </span>score_factor</span>
<span id="cb67-4"><a href="bias-in-the-algorithm.html#cb67-4"></a></span>
<span id="cb67-5"><a href="bias-in-the-algorithm.html#cb67-5"></a>fit &lt;-<span class="st"> </span><span class="kw">survfit</span>(f, <span class="dt">data =</span> input)</span>
<span id="cb67-6"><a href="bias-in-the-algorithm.html#cb67-6"></a></span>
<span id="cb67-7"><a href="bias-in-the-algorithm.html#cb67-7"></a>fit <span class="op">%&gt;%</span></span>
<span id="cb67-8"><a href="bias-in-the-algorithm.html#cb67-8"></a><span class="st">    </span><span class="kw">tidy</span>(<span class="dt">conf.int =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb67-9"><a href="bias-in-the-algorithm.html#cb67-9"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">strata =</span> <span class="kw">gsub</span>(<span class="st">&quot;score_factor=&quot;</span>,<span class="st">&quot;&quot;</span>, strata)) <span class="op">%&gt;%</span></span>
<span id="cb67-10"><a href="bias-in-the-algorithm.html#cb67-10"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">strata =</span> <span class="kw">factor</span>(strata, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;High&quot;</span>,<span class="st">&quot;Medium&quot;</span>,<span class="st">&quot;Low&quot;</span>))) <span class="op">%&gt;%</span></span>
<span id="cb67-11"><a href="bias-in-the-algorithm.html#cb67-11"></a><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> time, <span class="dt">y =</span> estimate, <span class="dt">ymax =</span> conf.high, <span class="dt">ymin =</span> conf.low, <span class="dt">group =</span> strata, <span class="dt">col =</span> strata)) <span class="op">+</span></span>
<span id="cb67-12"><a href="bias-in-the-algorithm.html#cb67-12"></a><span class="st">    </span><span class="kw">geom_pointrange</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>) <span class="op">+</span></span>
<span id="cb67-13"><a href="bias-in-the-algorithm.html#cb67-13"></a><span class="st">    </span><span class="kw">guides</span>(<span class="dt">colour =</span> <span class="kw">guide_legend</span>(<span class="dt">override.aes =</span> <span class="kw">list</span>(<span class="dt">alpha =</span> <span class="dv">1</span>))) <span class="op">+</span></span>
<span id="cb67-14"><a href="bias-in-the-algorithm.html#cb67-14"></a><span class="st">    </span><span class="kw">ylim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></span>
<span id="cb67-15"><a href="bias-in-the-algorithm.html#cb67-15"></a><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Estimated survival rate&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;Strata&quot;</span>)}</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="bias-in-the-algorithm.html#cb68-1"></a><span class="kw">visualize_surv</span>(df) <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Overall&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Black defendants do recidivate at higher rates according to race specific Kaplan Meier plots.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="bias-in-the-algorithm.html#cb69-1"></a>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(race <span class="op">==</span><span class="st"> &quot;Caucasian&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">visualize_surv</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Caucasian&quot;</span>)) <span class="op">/</span></span>
<span id="cb69-2"><a href="bias-in-the-algorithm.html#cb69-2"></a>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(race <span class="op">==</span><span class="st"> &quot;African-American&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">visualize_surv</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;African-American&quot;</span>)) </span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>In terms of underlying recidivism rates, we can look at gender specific Kaplan Meier estimates. There is a striking difference between women and men.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="bias-in-the-algorithm.html#cb70-1"></a>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sex <span class="op">==</span><span class="st"> &quot;Female&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">visualize_surv</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Female&quot;</span>)) <span class="op">/</span></span>
<span id="cb70-2"><a href="bias-in-the-algorithm.html#cb70-2"></a></span>
<span id="cb70-3"><a href="bias-in-the-algorithm.html#cb70-3"></a>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sex <span class="op">==</span><span class="st"> &quot;Male&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">visualize_surv</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">&quot;Male&quot;</span>))</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>As these plots show, the COMPAS score treats a High risk women the same as a Medium risk man.</p>
</div>
<div id="risk-of-recidivism-accuracy" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Risk of Recidivism Accuracy</h3>
<p>The above analysis shows that the COMPAS algorithm does overpredict African-American defendant’s future recidivism, but we haven’t yet explored the direction of the bias. We can discover fine differences in overprediction and underprediction by comparing COMPAS scores across racial lines.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="bias-in-the-algorithm.html#cb71-1"></a><span class="co"># create a new environment </span></span>
<span id="cb71-2"><a href="bias-in-the-algorithm.html#cb71-2"></a><span class="kw">conda_create</span>(<span class="st">&quot;r-reticulate&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;/home/jae/.local/share/r-miniconda/envs/r-reticulate/bin/python&quot;</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="bias-in-the-algorithm.html#cb73-1"></a><span class="co"># install libs </span></span>
<span id="cb73-2"><a href="bias-in-the-algorithm.html#cb73-2"></a><span class="kw">conda_install</span>(<span class="st">&quot;r-reticulate&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;pandas&quot;</span>))</span>
<span id="cb73-3"><a href="bias-in-the-algorithm.html#cb73-3"></a></span>
<span id="cb73-4"><a href="bias-in-the-algorithm.html#cb73-4"></a><span class="co"># indicate that we want to use a specific condaenv</span></span>
<span id="cb73-5"><a href="bias-in-the-algorithm.html#cb73-5"></a><span class="kw">use_condaenv</span>(<span class="st">&quot;r-reticulate&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb74"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="bias-in-the-algorithm.html#cb74-1"></a></span>
<span id="cb74-2"><a href="bias-in-the-algorithm.html#cb74-2"></a><span class="im">from</span> truth_tables <span class="im">import</span> PeekyReader, Person, table, is_race, count, vtable, hightable, vhightable</span>
<span id="cb74-3"><a href="bias-in-the-algorithm.html#cb74-3"></a><span class="im">from</span> csv <span class="im">import</span> DictReader</span>
<span id="cb74-4"><a href="bias-in-the-algorithm.html#cb74-4"></a></span>
<span id="cb74-5"><a href="bias-in-the-algorithm.html#cb74-5"></a>people <span class="op">=</span> []</span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb75-1"><a href="bias-in-the-algorithm.html#cb75-1"></a></span>
<span id="cb75-2"><a href="bias-in-the-algorithm.html#cb75-2"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;./data/cox-parsed.csv&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb75-3"><a href="bias-in-the-algorithm.html#cb75-3"></a>    reader <span class="op">=</span> PeekyReader(DictReader(f))</span>
<span id="cb75-4"><a href="bias-in-the-algorithm.html#cb75-4"></a>    <span class="cf">try</span>:</span>
<span id="cb75-5"><a href="bias-in-the-algorithm.html#cb75-5"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb75-6"><a href="bias-in-the-algorithm.html#cb75-6"></a>            p <span class="op">=</span> Person(reader)</span>
<span id="cb75-7"><a href="bias-in-the-algorithm.html#cb75-7"></a>            <span class="cf">if</span> p.valid:</span>
<span id="cb75-8"><a href="bias-in-the-algorithm.html#cb75-8"></a>                people.append(p)</span>
<span id="cb75-9"><a href="bias-in-the-algorithm.html#cb75-9"></a>    <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb75-10"><a href="bias-in-the-algorithm.html#cb75-10"></a>        <span class="cf">pass</span></span></code></pre></div>
<div class="sourceCode" id="cb76"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="bias-in-the-algorithm.html#cb76-1"></a></span>
<span id="cb76-2"><a href="bias-in-the-algorithm.html#cb76-2"></a>pop <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> i: ((i.recidivist <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> i.lifetime <span class="op">&lt;=</span> <span class="dv">730</span>) <span class="kw">or</span></span>
<span id="cb76-3"><a href="bias-in-the-algorithm.html#cb76-3"></a>                              i.lifetime <span class="op">&gt;</span> <span class="dv">730</span>), <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> x: x.score_valid, people))))</span>
<span id="cb76-4"><a href="bias-in-the-algorithm.html#cb76-4"></a></span>
<span id="cb76-5"><a href="bias-in-the-algorithm.html#cb76-5"></a>recid <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> i: i.recidivist <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> i.lifetime <span class="op">&lt;=</span> <span class="dv">730</span>, pop))</span>
<span id="cb76-6"><a href="bias-in-the-algorithm.html#cb76-6"></a></span>
<span id="cb76-7"><a href="bias-in-the-algorithm.html#cb76-7"></a>rset <span class="op">=</span> <span class="bu">set</span>(recid)</span>
<span id="cb76-8"><a href="bias-in-the-algorithm.html#cb76-8"></a></span>
<span id="cb76-9"><a href="bias-in-the-algorithm.html#cb76-9"></a>surv <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> pop <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> rset]</span></code></pre></div>
<p>Define a function for a table.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb77-1"><a href="bias-in-the-algorithm.html#cb77-1"></a></span>
<span id="cb77-2"><a href="bias-in-the-algorithm.html#cb77-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd </span>
<span id="cb77-3"><a href="bias-in-the-algorithm.html#cb77-3"></a></span>
<span id="cb77-4"><a href="bias-in-the-algorithm.html#cb77-4"></a><span class="kw">def</span> create_table(x, y):</span>
<span id="cb77-5"><a href="bias-in-the-algorithm.html#cb77-5"></a></span>
<span id="cb77-6"><a href="bias-in-the-algorithm.html#cb77-6"></a>  t <span class="op">=</span> table(<span class="bu">list</span>(x), <span class="bu">list</span>(y))</span>
<span id="cb77-7"><a href="bias-in-the-algorithm.html#cb77-7"></a>  </span>
<span id="cb77-8"><a href="bias-in-the-algorithm.html#cb77-8"></a>  df <span class="op">=</span> pd.DataFrame(t.items(), </span>
<span id="cb77-9"><a href="bias-in-the-algorithm.html#cb77-9"></a>             columns <span class="op">=</span> [<span class="st">&#39;Metrics&#39;</span>, <span class="st">&#39;Scores&#39;</span>])</span>
<span id="cb77-10"><a href="bias-in-the-algorithm.html#cb77-10"></a>             </span>
<span id="cb77-11"><a href="bias-in-the-algorithm.html#cb77-11"></a>  <span class="cf">return</span>(df)</span>
<span id="cb77-12"><a href="bias-in-the-algorithm.html#cb77-12"></a>             </span></code></pre></div>
<ul>
<li>All defenders</li>
</ul>
<div class="sourceCode" id="cb78"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb78-1"><a href="bias-in-the-algorithm.html#cb78-1"></a></span>
<span id="cb78-2"><a href="bias-in-the-algorithm.html#cb78-2"></a>create_table(<span class="bu">list</span>(recid), <span class="bu">list</span>(surv)).to_csv(<span class="st">&quot;data/table_recid.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="bias-in-the-algorithm.html#cb79-1"></a><span class="kw">read.csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;table_recid.csv&quot;</span>))[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb79-2"><a href="bias-in-the-algorithm.html#cb79-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Metrics, <span class="dt">y =</span> Scores)) <span class="op">+</span></span>
<span id="cb79-3"><a href="bias-in-the-algorithm.html#cb79-3"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb79-4"><a href="bias-in-the-algorithm.html#cb79-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Recidivism&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>That number is higher for African Americans at 44.85% and lower for whites at 23.45%.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb80-1"><a href="bias-in-the-algorithm.html#cb80-1"></a></span>
<span id="cb80-2"><a href="bias-in-the-algorithm.html#cb80-2"></a><span class="kw">def</span> create_comp_tables(recid_data, surv_data):</span>
<span id="cb80-3"><a href="bias-in-the-algorithm.html#cb80-3"></a>  </span>
<span id="cb80-4"><a href="bias-in-the-algorithm.html#cb80-4"></a>    <span class="co"># filtering variables </span></span>
<span id="cb80-5"><a href="bias-in-the-algorithm.html#cb80-5"></a>    is_afam <span class="op">=</span> is_race(<span class="st">&quot;African-American&quot;</span>)</span>
<span id="cb80-6"><a href="bias-in-the-algorithm.html#cb80-6"></a>    is_white <span class="op">=</span> is_race(<span class="st">&quot;Caucasian&quot;</span>)</span>
<span id="cb80-7"><a href="bias-in-the-algorithm.html#cb80-7"></a>  </span>
<span id="cb80-8"><a href="bias-in-the-algorithm.html#cb80-8"></a>    <span class="co"># dfs </span></span>
<span id="cb80-9"><a href="bias-in-the-algorithm.html#cb80-9"></a>    df1 <span class="op">=</span> create_table(<span class="bu">filter</span>(is_afam, recid_data),</span>
<span id="cb80-10"><a href="bias-in-the-algorithm.html#cb80-10"></a>                       <span class="bu">filter</span>(is_afam, surv_data))</span>
<span id="cb80-11"><a href="bias-in-the-algorithm.html#cb80-11"></a>  </span>
<span id="cb80-12"><a href="bias-in-the-algorithm.html#cb80-12"></a>    df2 <span class="op">=</span> create_table(<span class="bu">filter</span>(is_white, recid_data), </span>
<span id="cb80-13"><a href="bias-in-the-algorithm.html#cb80-13"></a>                       <span class="bu">filter</span>(is_white, surv_data))</span>
<span id="cb80-14"><a href="bias-in-the-algorithm.html#cb80-14"></a>  </span>
<span id="cb80-15"><a href="bias-in-the-algorithm.html#cb80-15"></a>    <span class="co"># concat </span></span>
<span id="cb80-16"><a href="bias-in-the-algorithm.html#cb80-16"></a>    dfs <span class="op">=</span> pd.concat([df1, df2])</span>
<span id="cb80-17"><a href="bias-in-the-algorithm.html#cb80-17"></a>    </span>
<span id="cb80-18"><a href="bias-in-the-algorithm.html#cb80-18"></a>    dfs[<span class="st">&#39;Group&#39;</span>] <span class="op">=</span> [<span class="st">&#39;African Americans&#39;</span>,<span class="st">&#39;African Americans&#39;</span>,<span class="st">&#39;Whites&#39;</span>,<span class="st">&#39;Whites&#39;</span>]</span>
<span id="cb80-19"><a href="bias-in-the-algorithm.html#cb80-19"></a>    </span>
<span id="cb80-20"><a href="bias-in-the-algorithm.html#cb80-20"></a>    <span class="cf">return</span>(dfs)</span>
<span id="cb80-21"><a href="bias-in-the-algorithm.html#cb80-21"></a>    </span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="bias-in-the-algorithm.html#cb81-1"></a></span>
<span id="cb81-2"><a href="bias-in-the-algorithm.html#cb81-2"></a>create_comp_tables(recid, surv).to_csv(<span class="st">&quot;data/comp_tables_recid.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="bias-in-the-algorithm.html#cb82-1"></a><span class="kw">read.csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;comp_tables_recid.csv&quot;</span>))[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb82-2"><a href="bias-in-the-algorithm.html#cb82-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Metrics, <span class="dt">y =</span> Scores, <span class="dt">fill =</span> Group)) <span class="op">+</span></span>
<span id="cb82-3"><a href="bias-in-the-algorithm.html#cb82-3"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb82-4"><a href="bias-in-the-algorithm.html#cb82-4"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb82-5"><a href="bias-in-the-algorithm.html#cb82-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Recidivism&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
</div>
<div id="risk-of-violent-recidivism" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Risk of violent recidivism</h3>
<p>COMPAS also offers a score that aims to measure a persons risk of violent recidivism, which has a similar overall accuracy to the Recidivism score.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="bias-in-the-algorithm.html#cb83-1"></a></span>
<span id="cb83-2"><a href="bias-in-the-algorithm.html#cb83-2"></a>vpeople <span class="op">=</span> []</span>
<span id="cb83-3"><a href="bias-in-the-algorithm.html#cb83-3"></a></span>
<span id="cb83-4"><a href="bias-in-the-algorithm.html#cb83-4"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;./data/cox-violent-parsed.csv&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb83-5"><a href="bias-in-the-algorithm.html#cb83-5"></a>    reader <span class="op">=</span> PeekyReader(DictReader(f))</span>
<span id="cb83-6"><a href="bias-in-the-algorithm.html#cb83-6"></a>    <span class="cf">try</span>:</span>
<span id="cb83-7"><a href="bias-in-the-algorithm.html#cb83-7"></a>        <span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb83-8"><a href="bias-in-the-algorithm.html#cb83-8"></a>            p <span class="op">=</span> Person(reader)</span>
<span id="cb83-9"><a href="bias-in-the-algorithm.html#cb83-9"></a>            <span class="cf">if</span> p.valid:</span>
<span id="cb83-10"><a href="bias-in-the-algorithm.html#cb83-10"></a>                vpeople.append(p)</span>
<span id="cb83-11"><a href="bias-in-the-algorithm.html#cb83-11"></a>    <span class="cf">except</span> <span class="pp">StopIteration</span>:</span>
<span id="cb83-12"><a href="bias-in-the-algorithm.html#cb83-12"></a>        <span class="cf">pass</span></span>
<span id="cb83-13"><a href="bias-in-the-algorithm.html#cb83-13"></a></span>
<span id="cb83-14"><a href="bias-in-the-algorithm.html#cb83-14"></a>vpop <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> i: ((i.violent_recidivist <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> i.lifetime <span class="op">&lt;=</span> <span class="dv">730</span>) <span class="kw">or</span></span>
<span id="cb83-15"><a href="bias-in-the-algorithm.html#cb83-15"></a>                              i.lifetime <span class="op">&gt;</span> <span class="dv">730</span>), <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> x: x.vscore_valid, vpeople))))</span>
<span id="cb83-16"><a href="bias-in-the-algorithm.html#cb83-16"></a></span>
<span id="cb83-17"><a href="bias-in-the-algorithm.html#cb83-17"></a>vrecid <span class="op">=</span> <span class="bu">list</span>(<span class="bu">filter</span>(<span class="kw">lambda</span> i: i.violent_recidivist <span class="op">==</span> <span class="va">True</span> <span class="kw">and</span> i.lifetime <span class="op">&lt;=</span> <span class="dv">730</span>, vpeople))</span>
<span id="cb83-18"><a href="bias-in-the-algorithm.html#cb83-18"></a></span>
<span id="cb83-19"><a href="bias-in-the-algorithm.html#cb83-19"></a>vrset <span class="op">=</span> <span class="bu">set</span>(vrecid)</span>
<span id="cb83-20"><a href="bias-in-the-algorithm.html#cb83-20"></a></span>
<span id="cb83-21"><a href="bias-in-the-algorithm.html#cb83-21"></a>vsurv <span class="op">=</span> [i <span class="cf">for</span> i <span class="kw">in</span> vpop <span class="cf">if</span> i <span class="kw">not</span> <span class="kw">in</span> vrset]</span></code></pre></div>
<div class="sourceCode" id="cb84"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="bias-in-the-algorithm.html#cb84-1"></a></span>
<span id="cb84-2"><a href="bias-in-the-algorithm.html#cb84-2"></a>create_table(vrecid, vsurv).to_csv(<span class="st">&quot;data/table_vrecid.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="bias-in-the-algorithm.html#cb85-1"></a><span class="kw">read.csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;table_vrecid.csv&quot;</span>))[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb85-2"><a href="bias-in-the-algorithm.html#cb85-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Metrics, <span class="dt">y =</span> Scores)) <span class="op">+</span></span>
<span id="cb85-3"><a href="bias-in-the-algorithm.html#cb85-3"></a><span class="st">  </span><span class="kw">geom_col</span>() <span class="op">+</span></span>
<span id="cb85-4"><a href="bias-in-the-algorithm.html#cb85-4"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Violent recidivism&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Even more so for Black defendants.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="bias-in-the-algorithm.html#cb86-1"></a></span>
<span id="cb86-2"><a href="bias-in-the-algorithm.html#cb86-2"></a>create_comp_tables(vrecid, vsurv).to_csv(<span class="st">&quot;data/comp_tables_vrecid.csv&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="bias-in-the-algorithm.html#cb87-1"></a><span class="kw">read.csv</span>(<span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;comp_tables_vrecid.csv&quot;</span>))[,<span class="op">-</span><span class="dv">1</span>] <span class="op">%&gt;%</span></span>
<span id="cb87-2"><a href="bias-in-the-algorithm.html#cb87-2"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Metrics, <span class="dt">y =</span> Scores, <span class="dt">fill =</span> Group)) <span class="op">+</span></span>
<span id="cb87-3"><a href="bias-in-the-algorithm.html#cb87-3"></a><span class="st">  </span><span class="kw">geom_col</span>(<span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>) <span class="op">+</span></span>
<span id="cb87-4"><a href="bias-in-the-algorithm.html#cb87-4"></a><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></span>
<span id="cb87-5"><a href="bias-in-the-algorithm.html#cb87-5"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Violent recidivism&quot;</span>)</span></code></pre></div>
<p><img src="03_algorithm_accuracy_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bias-in-the-data-risk-of-violent-recidivism-analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
